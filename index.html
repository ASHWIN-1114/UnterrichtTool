<!DOCTYPE html>
<html lang="de" class="h-full bg-[#0a0a0a]">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unterricht Tool 64</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Press Start 2P', cursive;
            background-color: #1a1c2c;
            color: #f0f0f0;
            image-rendering: pixelated;
        }
        
        #starfield {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
        }

        .scanline-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(to bottom, rgba(0,0,0,0.2) 50%, transparent 50%);
            background-size: 100% 4px;
            pointer-events: none;
        }

        /* Remove modern scrollbars */
        .scroll-container::-webkit-scrollbar { display: none; }
        .scroll-container { -ms-overflow-style: none; scrollbar-width: none; }

        .pixel-box {
            background-color: #2c3048;
            border: 4px solid #f0f0f0;
            box-shadow: inset 0 0 0 4px #1a1c2c;
        }

        .pixel-btn {
            background-color: #5a8cdb;
            color: #f0f0f0;
            border: 4px solid #f0f0f0;
            box-shadow: inset -4px -4px 0px 0px #3a6ab1;
            transition: all 0.1s ease-in-out;
        }
        .pixel-btn:hover:not(:disabled) {
            background-color: #6aa0e2;
        }
        .pixel-btn:active:not(:disabled) {
            transform: translateY(2px);
            box-shadow: inset -2px -2px 0px 0px #3a6ab1;
        }

        .pixel-btn-red {
            background-color: #db5a5a;
            box-shadow: inset -4px -4px 0px 0px #b13a3a;
        }
        .pixel-btn-red:hover:not(:disabled) { background-color: #e26a6a; }
        .pixel-btn-red:active:not(:disabled) { box-shadow: inset -2px -2px 0px 0px #b13a3a; }
        
        .pixel-btn-green {
            background-color: #5adb5a;
            box-shadow: inset -4px -4px 0px 0px #3ab13a;
        }
        .pixel-btn-green:hover:not(:disabled) { background-color: #6ae26a; }
        .pixel-btn-green:active:not(:disabled) { box-shadow: inset -2px -2px 0px 0px #3ab13a; }
        
        .pixel-btn-yellow {
            background-color: #dbc65a;
            box-shadow: inset -4px -4px 0px 0px #b1a03a;
        }
        .pixel-btn-yellow:hover:not(:disabled) { background-color: #e2d06a; }
        .pixel-btn-yellow:active:not(:disabled) { box-shadow: inset -2px -2px 0px 0px #b1a03a; }

        .pixel-input {
            background-color: #1a1c2c;
            border: 4px solid #f0f0f0;
            box-shadow: inset 4px 4px 0px 0px #0a0a0a;
        }

        /* Remove modern rounded corners */
        * {
            border-radius: 0 !important;
        }

        #hangman-drawing {
            shape-rendering: pixelated;
        }
        #hangman-drawing line, #hangman-drawing circle {
            stroke-width: 6px;
        }
        .keyboard-btn {
             box-shadow: inset -2px -2px 0px 0px #3a6ab1;
        }
        .keyboard-btn:active:not(:disabled) {
            transform: translateY(1px);
            box-shadow: inset -1px -1px 0px 0px #3a6ab1;
        }
        
        /* Remove modern animations/transitions */
        .animated-entry { animation: none; }
        .group-card { opacity: 1; transform: none; }
        #random-person-animation-container { transition: none; }
        .team-card, .team-card.current-turn { transition: none; }
        .team-card.current-turn { border-color: #5adb5a; transform: none; }

        /* Remove blur and modern effects */
        main {
            backdrop-filter: none;
            background-color: #2c3048;
            border: 4px solid #f0f0f0;
        }
        
        .game-mode-btn { border: 4px solid #f0f0f0; }
        .game-mode-btn.active { background-color: #db5a5a; }

        /* Overrides for elements that still had transitions or modern looks */
        .tab-button.active { color: #5adb5a; border-bottom-color: #5adb5a;}
        .absent-toggle { width: 60px; height: 30px; border: 4px solid #f0f0f0; background-color: #b13a3a; }
        .absent-toggle::before { content: ''; top: 2px; left: 2px; width: 18px; height: 18px; background-color: #f0f0f0; }
        .absent-toggle:checked { background-color: #3ab13a; }
        .absent-toggle:checked::before { transform: translateX(28px); }
        
        .modal {
            transition: opacity 0.1s linear !important;
        }
        
        /* New Defeat Animation */
        @keyframes defeat-shake-fall {
            0% { transform: translate(0, 0) rotate(0); opacity: 1; }
            10% { transform: translate(-2px, 0) rotate(-5deg); }
            20% { transform: translate(2px, 0) rotate(5deg); }
            30% { transform: translate(-2px, 0) rotate(-5deg); }
            40% { transform: translate(2px, 0) rotate(5deg); }
            50% { transform: translate(0, 0) rotate(0); opacity: 1; }
            100% { transform: translate(0, 50px) rotate(20deg); opacity: 0; }
        }

        .is-defeated {
            animation: defeat-shake-fall 1.5s ease-in-out forwards;
            transform-origin: 70px 35px; /* Around the head/rope */
        }

    </style>
</head>

<body class="h-full">
    <canvas id="starfield"></canvas>
    <div class="scanline-overlay"></div>
    <div class="flex flex-col min-h-screen items-center justify-start p-4">
        <!-- Header Section -->
        <header class="w-full flex justify-between items-center py-4 mb-8">
            <div></div>
            <h1 class="text-3xl md:text-4xl tracking-tight">
                Unterricht Tool 64
            </h1>
            <button id="sound-toggle-btn" class="pixel-btn p-2 text-xs">Sound: ON</button>
        </header>

        <!-- Main Content Container -->
        <main class="w-full max-w-5xl shadow-2xl p-6 md:p-10">
            
            <!-- Tab Navigation -->
            <div class="flex justify-center mb-8 border-b-4 border-f0f0f0">
                <button id="tools-tab-btn" class="tab-button active font-bold py-2 px-6">Werkzeuge</button>
                <button id="games-tab-btn" class="tab-button font-bold py-2 px-6">Spiele</button>
            </div>

            <!-- Tools Container -->
            <div id="tools-container">
                <div class="flex flex-col md:flex-row items-center justify-center gap-6 md:gap-10 mb-8">
                    <div class="flex items-center gap-4">
                        <label for="num-groups" class="text-sm">Gruppen:</label>
                        <input type="number" id="num-groups" value="2" min="1" class="pixel-input w-20 p-2 text-center">
                    </div>
                    <button id="split-groups-btn" class="pixel-btn w-full md:w-auto p-4 text-sm">
                        Gruppen bilden
                    </button>
                    <button id="random-person-btn" class="pixel-btn w-full md:w-auto p-4 text-sm">
                        Zufall
                    </button>
                </div>
                <div id="results-display" class="mt-8 pixel-box p-6 mb-8">
                    <h2 class="text-lg mb-2 text-center">Ergebnisse</h2>
                    <div id="random-person-animation-container" class="mb-4 text-center text-2xl font-bold"><div id="scrolling-names-list-wrapper" class="overflow-hidden w-full h-full"><div id="scrolling-names-list" class="flex flex-row items-center h-full"></div></div></div>
                    <div id="groups-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                    <p id="message-box" class="mt-4 text-center text-red-400 font-semibold hidden"></p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-10">
                    <div class="pixel-box p-6">
                        <h2 class="text-lg text-center">Schüler</h2>
                        <p id="student-count" class="text-sm text-center mb-4"></p>
                        <form id="student-form" class="flex gap-4"><input type="text" id="student-name-input" placeholder="Name..." class="pixel-input flex-1 p-3 text-sm"><button type="submit" class="pixel-btn p-3 text-sm">Add</button></form>
                        <div id="students-container" class="mt-4 scroll-container"><ul id="students-list" class="space-y-2"></ul></div>
                    </div>
                    <div class="pixel-box p-6">
                        <h2 class="text-lg mb-4 text-center">Themen</h2>
                        <form id="topic-form" class="flex gap-4"><input type="text" id="topic-name-input" placeholder="Thema..." class="pixel-input flex-1 p-3 text-sm"><button type="submit" class="pixel-btn p-3 text-sm">Add</button></form>
                        <div id="topics-container" class="mt-4 scroll-container"><ul id="topics-list" class="space-y-2"></ul></div>
                    </div>
                </div>
            </div>

            <!-- Games Container -->
            <div id="games-container" class="hidden">
                <div class="text-center mb-6">
                    <h2 class="text-2xl mb-4">Wähle ein Spiel</h2>
                    <div class="flex justify-center gap-4">
                        <button id="select-hangman-btn" class="pixel-btn active p-4">Galgenmännchen</button>
                        <button id="select-article-btn" class="pixel-btn p-4">Artikel-Raten</button>
                    </div>
                </div>

                <!-- Hangman Game Wrapper -->
                <div id="hangman-wrapper">
                    <div class="pixel-box p-6">
                        <div class="text-center mb-6 relative">
                            <h2 class="text-2xl">KI-Galgenmännchen</h2>
                            <button id="rules-btn" class="absolute top-0 right-0">
                                [?]
                            </button>
                        </div>
                        <div id="hangman-controls" class="flex flex-col gap-4 mb-6 p-4 bg-[#1a1c2c]">
                            <h3 class="text-lg text-center -mb-2">Settings</h3>
                            <div class="flex flex-col sm:flex-row gap-4 w-full">
                               <div class="flex-1">
                                    <label class="mb-2 block text-center text-sm">1. Modus</label>
                                    <div class="grid grid-cols-2 gap-2">
                                        <button id="single-player-btn" class="game-mode-btn active p-2 text-sm">Einzel</button>
                                        <button id="team-mode-btn" class="game-mode-btn p-2 text-sm">Team</button>
                                    </div>
                                </div>
                                <div id="num-teams-container" class="flex-1 hidden">
                                    <label for="num-teams-input" class="mb-2 block text-center text-sm">Teams</label>
                                    <input type="number" id="num-teams-input" value="2" min="2" class="pixel-input w-full p-2 text-center">
                                </div>
                            </div>
                             <div class="flex flex-col sm:flex-row gap-4 w-full">
                                <div class="flex-1">
                                    <label class="mb-2 block text-center text-sm">2. Thema/Niveau</label>
                                    <input type="text" id="hangman-topic-input" placeholder="Thema (z.B. Tiere)" class="pixel-input w-full p-2 text-sm">
                                </div>
                                <div class="flex-1">
                                    <label class="mb-2 block text-center text-[#1a1c2c] text-sm">.</label>
                                    <select id="hangman-level-select" class="pixel-input w-full p-2 text-sm">
                                        <option value="A1">Anfänger (A1)</option>
                                        <option value="A2">Grundlagen (A2)</option>
                                        <option value="B1">Mittelstufe (B1)</option>
                                        <option value="B2">Gute Mittelstufe (B2)</option>
                                    </select>
                                </div>
                            </div>
                            <button id="hangman-generate-btn" class="pixel-btn w-full p-3 text-sm mt-2">
                                <span id="generate-btn-text">3. START</span>
                                <div id="generate-spinner" class="spinner hidden ml-2"></div>
                            </button>
                        </div>
                        <div id="scoreboard" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-6"></div>
                        <div id="hangman-game" class="flex flex-col items-center gap-4 opacity-25 pointer-events-none">
                            <div class="relative w-48 h-56 mb-4">
                                <svg id="hangman-drawing" viewBox="0 0 100 120" class="w-full h-full">
                                    <line x1="20" y1="110" x2="80" y2="110" stroke="#9ca3af" /> <line x1="30" y1="110" x2="30" y2="10" stroke="#9ca3af" /> <line x1="30" y1="10" x2="70" y2="10" stroke="#9ca3af" /> <line x1="70" y1="10" x2="70" y2="25" stroke="#9ca3af" />
                                    <g id="hangman-figure">
                                        <circle class="hangman-part" cx="70" cy="35" r="10" stroke="white" fill="none" /> <line class="hangman-part" x1="70" y1="45" x2="70" y2="75" stroke="white" /> <line class="hangman-part" x1="70" y1="55" x2="55" y2="70" stroke="white" /> <line class="hangman-part" x1="70" y1="55" x2="85" y2="70" stroke="white" /> <line class="hangman-part" x1="70" y1="75" x2="55" y2="90" stroke="white" /> <line class="hangman-part" x1="70" y1="75" x2="85" y2="90" stroke="white" />
                                    </g>
                                </svg>
                            </div>
                            <p id="hangman-word" class="text-3xl tracking-widest"></p>
                            <div class="text-center text-sm">
                                 <p>Falsch:</p>
                                 <p id="hangman-wrong-letters" class="text-red-400 min-h-[28px]"></p>
                            </div>
                            <div id="hangman-keyboard" class="flex flex-wrap justify-center gap-2 max-w-lg"></div>
                            <div id="hangman-message" class="text-lg text-center min-h-[32px]"></div>
                            <div class="flex items-center gap-4 mt-4">
                                <button id="guess-word-btn" class="pixel-btn p-2 text-sm">Wort raten</button>
                                <button id="next-round-btn" class="pixel-btn pixel-btn-green p-2 text-sm hidden">Nächste Runde</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Article Guesser Game Wrapper -->
                <div id="article-guesser-wrapper" class="hidden">
                     <div class="pixel-box p-6">
                        <div class="text-center mb-6">
                            <h2 class="text-2xl">Artikel-Raten</h2>
                        </div>
                        <div id="article-controls" class="flex flex-col gap-4 mb-6 p-4 bg-[#1a1c2c]">
                            <h3 class="text-lg text-center -mb-2">Settings</h3>
                            <div class="flex flex-col sm:flex-row gap-4 w-full">
                                <div class="flex-1">
                                    <label class="mb-2 block text-center text-sm">Thema</label>
                                    <input type="text" id="article-topic-input" placeholder="Thema (z.B. Küche)" class="pixel-input w-full p-2 text-sm">
                                </div>
                                <div class="flex-1">
                                    <label class="mb-2 block text-center text-sm">Niveau</label>
                                    <select id="article-level-select" class="pixel-input w-full p-2 text-sm">
                                        <option value="A1">Anfänger (A1)</option><option value="A2">Grundlagen (A2)</option><option value="B1">Mittelstufe (B1)</option>
                                    </select>
                                </div>
                            </div>
                            <button id="article-generate-btn" class="pixel-btn w-full p-3 text-sm mt-2">
                                <span id="article-generate-btn-text">START</span>
                                <div id="article-generate-spinner" class="spinner hidden ml-2"></div>
                            </button>
                        </div>
                        <div id="article-game" class="flex flex-col items-center gap-6 opacity-25 pointer-events-none">
                            <div class="text-center">
                                <p id="article-game-message" class="text-lg text-center min-h-[32px]"></p>
                                <p id="article-word-display" class="text-4xl my-4 min-h-[50px]"></p>
                            </div>
                            <div id="article-choices" class="flex gap-4">
                                <button data-article="DER" class="article-btn pixel-btn p-6 text-2xl">DER</button>
                                <button data-article="DIE" class="article-btn pixel-btn pixel-btn-red p-6 text-2xl">DIE</button>
                                <button data-article="DAS" class="article-btn pixel-btn pixel-btn-green p-6 text-2xl">DAS</button>
                            </div>
                            <div id="article-scoreboard" class="flex gap-4 mt-4 text-lg">
                                <div>Richtig: <span id="article-score-correct">0</span></div>
                                <div>Falsch: <span id="article-score-wrong">0</span></div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="guess-word-modal" class="modal fixed inset-0 bg-black/70 flex items-center justify-center p-4 opacity-0 pointer-events-none">
        <div class="pixel-box p-6 w-full max-w-md text-center modal-content">
            <h3 id="guess-modal-title" class="text-lg mb-4"></h3>
            <p class="mb-4 text-sm">Gib das ganze Wort ein.</p>
            <input type="text" id="guess-word-input" class="pixel-input w-full p-2 text-center text-xl uppercase tracking-widest">
            <div class="flex gap-4 mt-6">
                <button id="submit-guess-btn" class="pixel-btn w-full p-2 text-sm">OK</button>
                <button id="cancel-guess-btn" class="pixel-btn pixel-btn-red w-full p-2 text-sm">Abbrechen</button>
            </div>
        </div>
    </div>
    
    <div id="rules-modal" class="modal fixed inset-0 bg-black/70 flex items-center justify-center p-4 opacity-0 pointer-events-none">
        <div class="pixel-box p-6 w-full max-w-lg text-left modal-content">
            <div class="flex justify-between items-center mb-4">
                 <h3 class="text-lg">Spielregeln</h3>
                 <button id="close-rules-btn" class="pixel-btn pixel-btn-red px-2 py-1">&times;</button>
            </div>
            <div class="space-y-4 text-sm">
                <div>
                    <h4 class="text-green-400">Allgemein</h4>
                    <ul class="list-disc">
                        <li>Errate das Wort, bevor der Galgenmann komplett ist (6 Fehler).</li>
                    </ul>
                </div>
                 <div>
                    <h4 class="text-green-400">Einzelspieler</h4>
                    <ul class="list-disc">
                        <li>Versuche, alle 10 Wörter zu erraten.</li>
                    </ul>
                </div>
                 <div>
                    <h4 class="text-green-400">Team-Modus</h4>
                    <ul class="list-disc">
                        <li>Teams raten abwechselnd. Falsch = Nächstes Team.</li>
                        <li><b>Punkte:</b>
                            <ul class="list-['-_'] ml-4">
                                <li><b>+5 Pkt.</b> pro richtiger Buchstabe.</li>
                                <li><b>+10 Bonus</b> für erratenes Wort.</li>
                                <li><b>+25 Bonus</b> für "Wort raten".</li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Main JavaScript Logic -->
    <script>
        // --- SOUND ENGINE ---
        let audioCtx;
        let isSoundOn = true;
        const soundToggleBtn = document.getElementById('sound-toggle-btn');
        
        function initAudio() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
        }

        function playSound(type) {
            if (!isSoundOn || !audioCtx) return;
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.type = 'square';
            
            switch(type) {
                case 'click':
                    oscillator.frequency.setValueAtTime(440, audioCtx.currentTime);
                    gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.1);
                    break;
                case 'correct':
                    oscillator.frequency.setValueAtTime(523.25, audioCtx.currentTime); // C5
                    gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.2);
                    break;
                case 'wrong':
                    oscillator.frequency.setValueAtTime(220, audioCtx.currentTime); // A3
                     gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.2);
                    break;
                case 'win':
                    oscillator.frequency.setValueAtTime(523.25, audioCtx.currentTime); // C5
                    oscillator.frequency.linearRampToValueAtTime(1046.50, audioCtx.currentTime + 0.2); // C6
                    gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.2);
                    break;
                case 'defeat':
                    oscillator.frequency.setValueAtTime(300, audioCtx.currentTime);
                    oscillator.frequency.linearRampToValueAtTime(150, audioCtx.currentTime + 0.4);
                    gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.4);
                    break;
            }

            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.5);
        }
        
        soundToggleBtn.addEventListener('click', () => {
            initAudio(); // Initialize on first click
            isSoundOn = !isSoundOn;
            soundToggleBtn.textContent = isSoundOn ? 'Sound: ON' : 'Sound: OFF';
            if(isSoundOn) playSound('click');
        });

        document.body.addEventListener('click', initAudio, { once: true });


        // --- STARFIELD BACKGROUND ---
        const starfieldCanvas = document.getElementById('starfield');
        const starfieldCtx = starfieldCanvas.getContext('2d');
        let stars = [];

        function resizeStarfield() {
            starfieldCanvas.width = window.innerWidth;
            starfieldCanvas.height = window.innerHeight;
        }

        function createStars() {
            stars = [];
            for(let i = 0; i < 200; i++) {
                stars.push({
                    x: Math.random() * starfieldCanvas.width,
                    y: Math.random() * starfieldCanvas.height,
                    size: Math.random() * 2 + 1,
                    speed: Math.random() * 0.5 + 0.1
                });
            }
        }
        
        function drawStars() {
            starfieldCtx.clearRect(0, 0, starfieldCanvas.width, starfieldCanvas.height);
            starfieldCtx.fillStyle = '#f0f0f0';
            stars.forEach(star => {
                star.y += star.speed;
                if(star.y > starfieldCanvas.height) {
                    star.y = 0;
                    star.x = Math.random() * starfieldCanvas.width;
                }
                starfieldCtx.fillRect(star.x, star.y, star.size, star.size);
            });
            requestAnimationFrame(drawStars);
        }

        window.addEventListener('resize', () => {
            resizeStarfield();
            createStars();
        });
        resizeStarfield();
        createStars();
        drawStars();

        // --- CORE APP LOGIC (unchanged) ---
        const studentForm = document.getElementById('student-form');
        const studentInput = document.getElementById('student-name-input');
        const studentsList = document.getElementById('students-list');
        const studentCountDisplay = document.getElementById('student-count');
        const topicForm = document.getElementById('topic-form');
        const topicInput = document.getElementById('topic-name-input');
        const topicsList = document.getElementById('topics-list');
        const splitGroupsBtn = document.getElementById('split-groups-btn');
        const randomPersonBtn = document.getElementById('random-person-btn');
        const numGroupsInput = document.getElementById('num-groups');
        const groupsContainer = document.getElementById('groups-container');
        const randomPersonDisplay = document.getElementById('random-person-animation-container');
        const messageBox = document.getElementById('message-box');
        const toolsTabBtn = document.getElementById('tools-tab-btn');
        const gamesTabBtn = document.getElementById('games-tab-btn');
        const toolsContainer = document.getElementById('tools-container');
        const gamesContainer = document.getElementById('games-container');
        let students = [];
        let topics = [];
        let createdGroups = [];
        function saveData() { localStorage.setItem('students_data', JSON.stringify(students)); localStorage.setItem('topics_data', JSON.stringify(topics)); renderStudents(); renderTopics(); }
        function loadData() { const storedStudents = localStorage.getItem('students_data'); const storedTopics = localStorage.getItem('topics_data'); if (storedStudents) students = JSON.parse(storedStudents); if (storedTopics) topics = JSON.parse(storedTopics); renderStudents(); renderTopics(); }
        function renderStudents() { studentsList.innerHTML = ''; const presentStudents = students.filter(s => !s.absent).length; studentCountDisplay.textContent = `(${presentStudents} / ${students.length} anwesend)`; students.forEach((student, index) => { const li = document.createElement('li'); li.classList.add('flex', 'items-center', 'justify-between', 'p-2', 'pr-3', 'bg-[#1a1c2c]', 'animated-entry'); const nameClasses = student.absent ? 'text-gray-500 line-through' : ''; li.innerHTML = `<span class="text-sm flex-grow ${nameClasses}">${student.name}</span><div class="flex items-center gap-4"><label class="flex items-center cursor-pointer"><span class="mr-2 text-xs">Abwesend</span><input type="checkbox" data-index="${index}" class="absent-toggle" ${student.absent ? 'checked' : ''}></label><button data-index="${index}" class="remove-student-btn text-red-400 hover:text-red-300"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg></button></div>`; studentsList.appendChild(li); }); }
        function renderTopics() { topicsList.innerHTML = ''; topics.forEach((topic, index) => { const li = document.createElement('li'); li.classList.add('flex', 'items-center', 'justify-between', 'p-2', 'bg-[#1a1c2c]'); li.innerHTML = `<span class="text-sm">${topic}</span><button data-index="${index}" class="remove-topic-btn text-red-400 hover:text-red-300"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg></button>`; topicsList.appendChild(li); }); }
        studentForm.addEventListener('submit', (e) => { e.preventDefault(); const studentName = studentInput.value.trim(); if (studentName) { playSound('click'); students.push({ name: studentName, absent: false }); studentInput.value = ''; saveData(); } });
        topicForm.addEventListener('submit', (e) => { e.preventDefault(); const topicName = topicInput.value.trim(); if (topicName) { playSound('click'); topics.push(topicName); topicInput.value = ''; saveData(); } });
        studentsList.addEventListener('click', (e) => { const removeBtn = e.target.closest('.remove-student-btn'); if (removeBtn) { playSound('click'); students.splice(removeBtn.dataset.index, 1); saveData(); } });
        studentsList.addEventListener('change', (e) => { if (e.target.classList.contains('absent-toggle')) { playSound('click'); students[e.target.dataset.index].absent = e.target.checked; saveData(); } });
        topicsList.addEventListener('click', (e) => { const removeBtn = e.target.closest('.remove-topic-btn'); if (removeBtn) { playSound('click'); topics.splice(removeBtn.dataset.index, 1); saveData(); } });
        function shuffleArray(array) { for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1));[array[i], array[j]] = [array[j], array[i]]; } return array; }
        splitGroupsBtn.addEventListener('click', () => { playSound('click'); const presentStudents = students.filter(s => !s.absent).map(s => s.name); const numGroups = parseInt(numGroupsInput.value, 10); if (numGroups < 1 || numGroups > presentStudents.length) { messageBox.textContent = `Bitte geben Sie eine Zahl zwischen 1 und ${presentStudents.length} ein.`; messageBox.classList.remove('hidden'); return; } messageBox.classList.add('hidden'); const shuffledStudents = shuffleArray([...presentStudents]); const shuffledTopics = shuffleArray([...topics]); groupsContainer.innerHTML = ''; randomPersonDisplay.classList.remove('active'); createdGroups = Array.from({ length: numGroups }, () => ({ students: [], topic: null })); let studentIndex = 0; while (studentIndex < shuffledStudents.length) { for (let i = 0; i < numGroups; i++) { if (studentIndex < shuffledStudents.length) { createdGroups[i].students.push(shuffledStudents[studentIndex]); studentIndex++; } } } if (topics.length > 0) { for (let i = 0; i < numGroups; i++) { createdGroups[i].topic = shuffledTopics[i % shuffledTopics.length]; } } displayGroups(createdGroups); });
        function displayGroups(groups) { groupsContainer.innerHTML = ''; const groupElements = []; groups.forEach((group, index) => { const groupDiv = document.createElement('div'); groupDiv.classList.add('pixel-box', 'p-6', 'flex', 'flex-col', 'gap-4', 'group-card'); let topicHtml = group.topic ? `<p class="text-center text-sm">Thema: <span class="text-green-400">${group.topic}</span></p>` : ''; groupDiv.innerHTML = `<h3 class="text-md text-center">Gruppe ${index + 1}</h3>${topicHtml}<ul class="space-y-2">${group.students.map(student => `<li class="p-2 bg-[#1a1c2c] text-sm">${student}</li>`).join('')}</ul>`; groupsContainer.appendChild(groupDiv); groupElements.push(groupDiv); }); groupElements.forEach((el, i) => setTimeout(() => el.classList.add('visible'), i * 150)); }
        randomPersonBtn.addEventListener('click', () => { playSound('click'); const presentStudents = students.filter(s => !s.absent).map(s => s.name); groupsContainer.innerHTML = ''; messageBox.classList.add('hidden'); randomPersonDisplay.classList.add('active'); if (presentStudents.length === 0) { randomPersonDisplay.innerHTML = `<p class="p-4 bg-red-900/50">Keine anwesenden Schüler zum Auswählen vorhanden.</p>`; return; } randomPersonBtn.disabled = true; const selectedStudent = presentStudents[Math.floor(Math.random() * presentStudents.length)]; randomPersonDisplay.innerHTML = `<div id="scrolling-names-list-wrapper" class="overflow-hidden w-full h-full"><div id="scrolling-names-list" class="flex flex-row items-center h-full"></div></div>`; const namesList = document.getElementById('scrolling-names-list'); const duplicatedNames = []; const namesPerGroup = presentStudents.length; const groupsToDisplay = 20; const randomIndexInFinalGroup = Math.floor(Math.random() * namesPerGroup); const finalStudentAbsoluteIndex = (groupsToDisplay - 1) * namesPerGroup + randomIndexInFinalGroup; for (let i = 0; i < groupsToDisplay - 1; i++) { duplicatedNames.push(...shuffleArray([...presentStudents])); } const finalGroup = shuffleArray([...presentStudents]); finalGroup.splice(randomIndexInFinalGroup, 0, selectedStudent); duplicatedNames.push(...finalGroup); duplicatedNames.forEach(name => { const p = document.createElement('p'); p.classList.add('p-2', 'text-2xl', 'mx-4', 'inline-block', 'whitespace-nowrap'); p.textContent = name; namesList.appendChild(p); }); const finalElement = namesList.children[finalStudentAbsoluteIndex]; setTimeout(() => { const containerWidth = randomPersonDisplay.offsetWidth; const finalPosition = finalElement.offsetLeft - (containerWidth / 2) + (finalElement.offsetWidth / 2); namesList.style.transition = 'transform 2.5s cubic-bezier(0.25, 0.1, 0.25, 1)'; namesList.style.transform = `translateX(-${finalPosition}px)`; }, 100); namesList.addEventListener('transitionend', () => { playSound('win'); randomPersonBtn.disabled = false; finalElement.classList.add('bg-green-500', 'p-2'); }, { once: true }); });
        toolsTabBtn.addEventListener('click', () => { playSound('click'); toolsContainer.classList.remove('hidden'); gamesContainer.classList.add('hidden'); toolsTabBtn.classList.add('active'); gamesTabBtn.classList.remove('active'); });
        gamesTabBtn.addEventListener('click', () => { playSound('click'); toolsContainer.classList.add('hidden'); gamesContainer.classList.remove('hidden'); toolsTabBtn.classList.remove('active'); gamesTabBtn.classList.add('active'); });
        
        // --- GAME LOGIC ---
        const hangmanWrapper = document.getElementById('hangman-wrapper');
        const articleGuesserWrapper = document.getElementById('article-guesser-wrapper');
        const selectHangmanBtn = document.getElementById('select-hangman-btn');
        const selectArticleBtn = document.getElementById('select-article-btn');

        selectHangmanBtn.addEventListener('click', () => {
            playSound('click');
            hangmanWrapper.classList.remove('hidden');
            articleGuesserWrapper.classList.add('hidden');
            selectHangmanBtn.classList.add('active');
            selectArticleBtn.classList.remove('active');
        });

        selectArticleBtn.addEventListener('click', () => {
            playSound('click');
            hangmanWrapper.classList.add('hidden');
            articleGuesserWrapper.classList.remove('hidden');
            selectHangmanBtn.classList.remove('active');
            selectArticleBtn.classList.add('active');
        });


        // --- HANGMAN GAME ---
        const hangmanGameEl = document.getElementById('hangman-game');
        const hangmanTopicInput = document.getElementById('hangman-topic-input');
        const hangmanLevelSelect = document.getElementById('hangman-level-select');
        const hangmanGenerateBtn = document.getElementById('hangman-generate-btn');
        const generateBtnText = document.getElementById('generate-btn-text');
        const generateSpinner = document.getElementById('generate-spinner');
        const hangmanWordEl = document.getElementById('hangman-word');
        const hangmanDrawing = document.getElementById('hangman-drawing');
        const hangmanFigure = document.getElementById('hangman-figure');
        const hangmanParts = hangmanDrawing.querySelectorAll('.hangman-part');
        const hangmanWrongLettersEl = document.getElementById('hangman-wrong-letters');
        const hangmanKeyboardEl = document.getElementById('hangman-keyboard');
        const hangmanMessageEl = document.getElementById('hangman-message');
        const scoreboardEl = document.getElementById('scoreboard');
        const guessWordBtn = document.getElementById('guess-word-btn');
        const nextRoundBtn = document.getElementById('next-round-btn');
        const singlePlayerBtn = document.getElementById('single-player-btn');
        const teamModeBtn = document.getElementById('team-mode-btn');
        const numTeamsContainer = document.getElementById('num-teams-container');
        const numTeamsInput = document.getElementById('num-teams-input');
        const guessWordModal = document.getElementById('guess-word-modal');
        const guessModalTitle = document.getElementById('guess-modal-title');
        const guessWordInput = document.getElementById('guess-word-input');
        const submitGuessBtn = document.getElementById('submit-guess-btn');
        const cancelGuessBtn = document.getElementById('cancel-guess-btn');
        const rulesBtn = document.getElementById('rules-btn');
        const rulesModal = document.getElementById('rules-modal');
        const closeRulesBtn = document.getElementById('close-rules-btn');
        const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZÄÖÜ'.split('');
        const maxWrongGuesses = 6;
        let gameMode = 'single';
        let gameState = {};
        singlePlayerBtn.addEventListener('click', () => { playSound('click'); gameMode = 'single'; singlePlayerBtn.classList.add('active'); teamModeBtn.classList.remove('active'); numTeamsContainer.classList.add('hidden'); });
        teamModeBtn.addEventListener('click', () => { playSound('click'); gameMode = 'team'; teamModeBtn.classList.add('active'); singlePlayerBtn.classList.remove('active'); numTeamsContainer.classList.remove('hidden'); });
        function resetGameState() { gameState = { teams: [], currentTeamIndex: 0, selectedWord: '', correctLetters: [], wrongLetters: [], isRoundOver: true, wordList: [], currentWordIndex: 0, }; }
        async function startGame() { playSound('click'); const topic = hangmanTopicInput.value.trim(); const level = hangmanLevelSelect.value; if (!topic) { alert("Bitte geben Sie ein Thema ein."); return; }
            hangmanGenerateBtn.disabled = true; generateBtnText.textContent = 'Generiere...'; generateSpinner.classList.remove('hidden'); hangmanGameEl.classList.add('opacity-25', 'pointer-events-none'); hangmanMessageEl.textContent = 'KI generiert Wörter...'; scoreboardEl.innerHTML = '';
            const apiKey = ""; const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`; const prompt = `Generate a list of 10 single German nouns (without articles) related to the topic '${topic}'. The words should be suitable for a German language learner at the ${level} level. The words should not contain spaces or special characters other than Ä, Ö, Ü. Return ONLY a comma-separated list of the words in uppercase. For example: HUND,KATZE,HAUS`;
            try { const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] }) }); if (!response.ok) throw new Error(`API error! status: ${response.status}`);
                const result = await response.json(); const text = result.candidates?.[0]?.content?.parts?.[0]?.text; if (!text) throw new Error('Keine Wörter von der KI erhalten.');
                const words = text.split(',').map(word => word.trim().toUpperCase()).filter(word => word.length > 0); if(words.length === 0) throw new Error('KI konnte keine Wörter generieren.');
                resetGameState();
                if (gameMode === 'single') { gameState.teams = [{ id: 0, name: 'Spieler 1', score: 0 }]; } else { const numTeams = parseInt(numTeamsInput.value, 10); if (isNaN(numTeams) || numTeams < 2) { alert("Bitte geben Sie eine gültige Team-Anzahl ein."); throw new Error("Invalid team number"); } gameState.teams = Array.from({ length: numTeams }, (_, i) => ({ id: i, name: `Team ${i + 1}`, score: 0 })); }
                gameState.wordList = shuffleArray(words); startNewRound();
            } catch (error) { console.error('Error in startGame:', error); if (error.message !== "Invalid team number") { hangmanMessageEl.textContent = `Fehler: ${error.message}`; }
            } finally { hangmanGenerateBtn.disabled = false; generateBtnText.textContent = '3. START'; generateSpinner.classList.add('hidden'); } }
        function startNewRound() { if (gameState.currentWordIndex >= gameState.wordList.length) { endGame(); return; }
            gameState.selectedWord = gameState.wordList[gameState.currentWordIndex]; gameState.currentWordIndex++; gameState.correctLetters = []; gameState.wrongLetters = []; gameState.isRoundOver = false;
            hangmanGameEl.classList.remove('opacity-25', 'pointer-events-none'); 
            hangmanFigure.classList.remove('is-defeated'); 
            hangmanParts.forEach(part => part.style.visibility = 'hidden'); hangmanMessageEl.textContent = ''; nextRoundBtn.classList.add('hidden'); guessWordBtn.classList.remove('hidden');
            displayHangmanWord(); updateWrongLetters(); createKeyboard(); renderScoreboard(); }
        function renderScoreboard() { scoreboardEl.innerHTML = ''; if (gameState.teams.length <= 1) return;
            gameState.teams.forEach((team, index) => { const card = document.createElement('div'); card.classList.add('team-card', 'pixel-box', 'p-3', 'text-center'); if (index === gameState.currentTeamIndex) { card.classList.add('current-turn'); }
                card.innerHTML = `<p class="text-sm">${team.name}</p><p id="score-${team.id}" class="text-xl">${team.score}</p>`; scoreboardEl.appendChild(card); }); }
        function displayHangmanWord() { if (!gameState.selectedWord) return;
            hangmanWordEl.innerHTML = gameState.selectedWord.split('').map(letter => `<span>${gameState.correctLetters.includes(letter) ? letter : '_'}</span>`).join('');
            const innerWord = hangmanWordEl.innerText.replace(/\s/g, ''); if (!gameState.isRoundOver && innerWord === gameState.selectedWord) { awardPoints(10); endRound(true); } }
        function updateWrongLetters() { hangmanWrongLettersEl.textContent = `${gameState.wrongLetters.join(', ')}`; hangmanParts.forEach((part, index) => { if (index < gameState.wrongLetters.length) part.style.visibility = 'visible'; });
            if (!gameState.isRoundOver && gameState.wrongLetters.length >= maxWrongGuesses) { endRound(false); } }
        function createKeyboard() { hangmanKeyboardEl.innerHTML = ''; alphabet.forEach(letter => { const btn = document.createElement('button'); btn.textContent = letter; btn.classList.add('keyboard-btn', 'pixel-btn', 'py-2', 'px-3', 'text-sm'); btn.addEventListener('click', () => handleGuess(letter, btn)); hangmanKeyboardEl.appendChild(btn); }); }
        function handleGuess(letter, btn) { if (gameState.isRoundOver) return; btn.disabled = true; const upperCaseLetter = letter.toUpperCase();
            if (gameState.selectedWord.includes(upperCaseLetter)) { playSound('correct'); if (!gameState.correctLetters.includes(upperCaseLetter)) { gameState.correctLetters.push(upperCaseLetter); awardPoints(5); displayHangmanWord(); }
            } else { playSound('wrong'); if (!gameState.wrongLetters.includes(upperCaseLetter)) { gameState.wrongLetters.push(upperCaseLetter); updateWrongLetters(); changeTurn(); } } }
        function changeTurn() { if (gameState.teams.length <= 1) return; gameState.currentTeamIndex = (gameState.currentTeamIndex + 1) % gameState.teams.length; renderScoreboard(); }
        function awardPoints(points) { if (gameState.teams.length === 0) return; const currentTeam = gameState.teams[gameState.currentTeamIndex]; currentTeam.score += points; const scoreEl = document.getElementById(`score-${currentTeam.id}`); if (scoreEl) { scoreEl.textContent = currentTeam.score; } }
        function endRound(isWin) {
            gameState.isRoundOver = true;
            hangmanKeyboardEl.querySelectorAll('.keyboard-btn').forEach(btn => btn.disabled = true);
            guessWordBtn.classList.add('hidden');

            if (isWin) { 
                playSound('win'); 
                const winnerName = gameState.teams.length > 1 ? gameState.teams[gameState.currentTeamIndex].name : 'Du hast'; 
                hangmanMessageEl.textContent = `${winnerName} GEWONNEN!`;
                nextRoundBtn.classList.remove('hidden');
            } else { 
                playSound('defeat');
                hangmanFigure.classList.add('is-defeated');
                hangmanMessageEl.textContent = `VERLOREN! Wort: ${gameState.selectedWord}`; 
                setTimeout(() => {
                    nextRoundBtn.classList.remove('hidden');
                }, 1500);
            }
        }
        function endGame() { let winnerMessage = ''; if (gameState.teams.length > 1) { const winner = gameState.teams.reduce((prev, current) => (prev.score > current.score) ? prev : current); winnerMessage = `GAME OVER! ${winner.name} gewinnt! 🎉`;
            } else { winnerMessage = 'Alle Wörter gespielt!'; }
            hangmanMessageEl.textContent = winnerMessage; nextRoundBtn.classList.add('hidden'); guessWordBtn.classList.add('hidden'); }
        function openModal(modal) { playSound('click'); modal.classList.remove('opacity-0', 'pointer-events-none'); }
        function closeModal(modal) { playSound('click'); modal.classList.add('opacity-0', 'pointer-events-none'); }
        function handleWordGuess() { const guess = guessWordInput.value.trim().toUpperCase(); if (!guess) return;
            if (guess === gameState.selectedWord) { awardPoints(25); gameState.correctLetters = gameState.selectedWord.split(''); displayHangmanWord(); endRound(true);
            } else { playSound('wrong'); const guesserName = gameState.teams.length > 1 ? gameState.teams[gameState.currentTeamIndex].name : 'Du hast'; hangmanMessageEl.textContent = `${guesserName} falsch geraten!`; changeTurn(); }
            closeModal(guessWordModal); }
        guessWordBtn.addEventListener('click', () => openModal(guessWordModal));
        cancelGuessBtn.addEventListener('click', () => closeModal(guessWordModal));
        rulesBtn.addEventListener('click', () => openModal(rulesModal));
        closeRulesBtn.addEventListener('click', () => closeModal(rulesModal));
        submitGuessBtn.addEventListener('click', handleWordGuess);
        guessWordInput.addEventListener('keyup', (e) => { if(e.key === 'Enter') handleWordGuess(); });
        nextRoundBtn.addEventListener('click', ()=>{playSound('click'); startNewRound()});
        hangmanGenerateBtn.addEventListener('click', startGame);

        // --- ARTICLE GUESSER GAME ---
        const articleControls = document.getElementById('article-controls');
        const articleGame = document.getElementById('article-game');
        const articleTopicInput = document.getElementById('article-topic-input');
        const articleLevelSelect = document.getElementById('article-level-select');
        const articleGenerateBtn = document.getElementById('article-generate-btn');
        const articleGenerateBtnText = document.getElementById('article-generate-btn-text');
        const articleGenerateSpinner = document.getElementById('article-generate-spinner');
        const articleWordDisplay = document.getElementById('article-word-display');
        const articleChoices = document.getElementById('article-choices');
        const articleScoreCorrect = document.getElementById('article-score-correct');
        const articleScoreWrong = document.getElementById('article-score-wrong');
        const articleGameMessage = document.getElementById('article-game-message');
        
        let articleGameState = {};

        function resetArticleGameState() {
            articleGameState = {
                wordList: [],
                currentWordIndex: 0,
                correct: 0,
                wrong: 0,
            };
        }

        async function startArticleGame() {
            playSound('click');
            const topic = articleTopicInput.value.trim();
            const level = articleLevelSelect.value;
            if (!topic) { alert("Bitte geben Sie ein Thema ein."); return; }

            articleGenerateBtn.disabled = true; articleGenerateBtnText.textContent = 'Generiere...'; articleGenerateSpinner.classList.remove('hidden'); articleGame.classList.add('opacity-25', 'pointer-events-none');
            
            const apiKey = ""; const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const prompt = `Generate a list of 10 German nouns with their definite article (DER, DIE, or DAS) related to the topic '${topic}', suitable for a ${level} learner. Return ONLY a comma-separated list. Example: DER HUND,DIE KATZE,DAS HAUS`;

            try {
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] }) });
                if (!response.ok) throw new Error(`API error! status: ${response.status}`);
                const result = await response.json(); const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                if (!text) throw new Error('Keine Wörter von der KI erhalten.');
                const words = text.split(',').map(pair => {
                    const parts = pair.trim().split(' ');
                    return { article: parts[0], noun: parts[1] };
                }).filter(w => w.article && w.noun);
                 if(words.length === 0) throw new Error('KI konnte keine Wörter generieren.');
                
                resetArticleGameState();
                articleGameState.wordList = shuffleArray(words);
                articleGame.classList.remove('opacity-25', 'pointer-events-none');
                nextArticleWord();

            } catch (error) {
                console.error(error);
                articleGameMessage.textContent = `Fehler: ${error.message}`;
            } finally {
                articleGenerateBtn.disabled = false; articleGenerateBtnText.textContent = 'START'; articleGenerateSpinner.classList.add('hidden');
            }
        }
        
        function nextArticleWord() {
            if (articleGameState.currentWordIndex >= articleGameState.wordList.length) {
                articleWordDisplay.textContent = "Fertig!";
                articleGameMessage.textContent = `Endstand: ${articleGameState.correct} Richtig, ${articleGameState.wrong} Falsch.`;
                articleChoices.classList.add('hidden');
                return;
            }
            articleGameMessage.textContent = `Wort ${articleGameState.currentWordIndex + 1} / ${articleGameState.wordList.length}`;
            const currentWord = articleGameState.wordList[articleGameState.currentWordIndex];
            articleWordDisplay.textContent = currentWord.noun;
            articleScoreCorrect.textContent = articleGameState.correct;
            articleScoreWrong.textContent = articleGameState.wrong;
            articleChoices.classList.remove('hidden');
        }

        articleChoices.addEventListener('click', (e) => {
            if (!e.target.matches('.article-btn')) return;
            const chosenArticle = e.target.dataset.article;
            const correctArticle = articleGameState.wordList[articleGameState.currentWordIndex].article;

            if (chosenArticle === correctArticle) {
                playSound('correct');
                articleGameState.correct++;
                articleGameMessage.textContent = "Richtig!";
            } else {
                playSound('wrong');
                articleGameState.wrong++;
                articleGameMessage.textContent = `Falsch! Richtig ist: ${correctArticle} ${articleGameState.wordList[articleGameState.currentWordIndex].noun}`;
            }
            articleGameState.currentWordIndex++;
            setTimeout(nextArticleWord, 1500);
        });

        articleGenerateBtn.addEventListener('click', startArticleGame);

        // --- INITIAL LOAD ---
        document.addEventListener('DOMContentLoaded', () => { resetGameState(); loadData(); });
    </script>
</body>
</html>

