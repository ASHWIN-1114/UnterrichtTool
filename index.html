<!DOCTYPE html>
<html lang="de" class="h-full bg-[#0a0a0a]">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unterricht Tool DX</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'VT323', monospace;
            background-color: #1a1c2c;
            color: #f0f0f0;
            image-rendering: pixelated;
        }
        
        #starfield {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
        }

        .scanline-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(to bottom, rgba(0,0,0,0.1) 50%, transparent 50%);
            background-size: 100% 3px;
            pointer-events: none;
            opacity: 0.5;
        }

        /* Remove modern scrollbars */
        .scroll-container::-webkit-scrollbar { display: none; }
        .scroll-container { -ms-overflow-style: none; scrollbar-width: none; }
        
        main, #loading-screen {
            transition: opacity 0.5s ease-in-out;
        }

        .main-container {
             background-color: #2c3048;
             border: 3px solid #f0f0f0;
        }

        .inner-box {
            background-color: #1a1c2c;
            border: 3px solid #f0f0f0;
        }
        
        .tab-button.active {
            color: #5adb5a;
            border-bottom-color: #5adb5a;
        }
        
        .game-mode-btn.active {
            background-color: #db5a5a;
            color: white;
            border-color: #f0f0f0;
        }
        
        #hangman-word {
            letter-spacing: 0.5em;
        }
        
        /* Defeat Animation */
        @keyframes defeat-swing-drop {
            0% { transform: rotate(0) translateY(0); }
            15% { transform: rotate(7deg); }
            30% { transform: rotate(-7deg); }
            45% { transform: rotate(4deg); }
            60% { transform: rotate(-4deg); }
            75% { transform: rotate(0deg) translateY(0); }
            100% { transform: rotate(0deg) translateY(15px); }
        }

        .is-defeated {
            animation: defeat-swing-drop 1.2s ease-in-out forwards;
            transform-origin: 70px 25px; /* Around the rope */
        }
        
        /* Remove modern rounded corners */
        * {
            border-radius: 0 !important;
        }
        
        .pixel-btn {
            background-color: #5a8cdb;
            color: #f0f0f0;
            border: 3px solid #f0f0f0;
            box-shadow: inset -4px -4px 0px 0px #3a6ab1;
            transition: all 0.1s ease-in-out;
        }
        .pixel-btn:hover:not(:disabled) {
            background-color: #6aa0e2;
        }
        .pixel-btn:active:not(:disabled) {
            transform: translateY(2px);
            box-shadow: inset -2px -2px 0px 0px #3a6ab1;
        }

        .pixel-btn-red {
            background-color: #db5a5a;
            box-shadow: inset -4px -4px 0px 0px #b13a3a;
        }
        .pixel-btn-red:hover:not(:disabled) { background-color: #e26a6a; }
        
        .pixel-btn-green {
            background-color: #5adb5a;
            box-shadow: inset -4px -4px 0px 0px #3ab13a;
        }
        .pixel-btn-green:hover:not(:disabled) { background-color: #6ae26a; }

        .pixel-input {
            background-color: #1a1c2c;
            border: 3px solid #f0f0f0;
            box-shadow: inset 3px 3px 0px 0px #0a0a0a;
        }
    </style>
</head>

<body class="h-full">
    <canvas id="starfield"></canvas>
    <div class="scanline-overlay"></div>

    <!-- Loading Screen -->
    <div id="loading-screen" class="fixed inset-0 z-50 flex flex-col items-center justify-center text-center p-4">
        <h1 class="text-7xl md:text-9xl text-white mb-4" style="text-shadow: 6px 6px #5a8cdb;">Unterricht Tool DX</h1>
        <p class="text-2xl text-gray-300 mb-8">Ein modernes Werkzeug f√ºr den Unterricht</p>
        <button id="start-app-btn" class="pixel-btn text-2xl py-4 px-8">
            Spiel starten
        </button>
    </div>

    <div class="flex flex-col min-h-screen items-center justify-start p-4">
        <!-- Header Section -->
        <header class="w-full flex justify-between items-center py-4 mb-8">
            <h1 class="text-5xl tracking-tight text-white">
                Unterricht Tool DX
            </h1>
            <button id="sound-toggle-btn" class="pixel-btn text-lg py-2 px-4">Sound: ON</button>
        </header>

        <!-- Main Content Container -->
        <main class="w-full max-w-5xl main-container shadow-2xl p-6 md:p-10 opacity-0 pointer-events-none">
            
            <!-- Tab Navigation -->
            <div class="flex justify-center mb-8 border-b-3 border-white">
                <button id="tools-tab-btn" class="tab-button active text-2xl font-bold py-2 px-6 transition">Werkzeuge</button>
                <button id="games-tab-btn" class="tab-button text-2xl font-bold py-2 px-6 transition">Spiele</button>
            </div>

            <!-- Tools Container -->
            <div id="tools-container">
                <div class="flex flex-col md:flex-row items-center justify-center gap-6 md:gap-10 mb-8">
                    <div class="flex items-center gap-4">
                        <label for="num-groups" class="text-2xl">Gruppen:</label>
                        <input type="number" id="num-groups" value="2" min="1" class="pixel-input text-2xl w-24 p-2 text-center">
                    </div>
                    <button id="split-groups-btn" class="pixel-btn text-2xl p-4">
                        Gruppen bilden
                    </button>
                    <button id="random-person-btn" class="pixel-btn text-2xl p-4">
                        Zufall
                    </button>
                </div>
                <div id="results-display" class="mt-8 inner-box p-6 mb-8">
                    <h2 class="text-3xl mb-4 text-center text-white">Ergebnisse</h2>
                    <div id="random-person-animation-container" class="mb-4 text-center text-3xl font-bold"><div id="scrolling-names-list-wrapper" class="overflow-hidden w-full h-full"><div id="scrolling-names-list" class="flex flex-row items-center h-full"></div></div></div>
                    <div id="groups-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
                    <p id="message-box" class="mt-4 text-center text-red-400 font-semibold hidden text-xl"></p>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-10">
                    <div class="inner-box p-6">
                        <h2 class="text-3xl text-center text-white">Sch√ºler</h2>
                        <p id="student-count" class="text-xl text-center text-gray-400 my-4"></p>
                        <form id="student-form" class="flex gap-4"><input type="text" id="student-name-input" placeholder="Name..." class="pixel-input text-xl flex-1 p-3"><button type="submit" class="pixel-btn text-xl p-3">Add</button></form>
                        <div id="students-container" class="mt-4 scroll-container"><ul id="students-list" class="space-y-2"></ul></div>
                    </div>
                    <div class="inner-box p-6">
                        <h2 class="text-3xl mb-4 text-center text-white">Themen</h2>
                        <form id="topic-form" class="flex gap-4"><input type="text" id="topic-name-input" placeholder="Thema..." class="pixel-input text-xl flex-1 p-3"><button type="submit" class="pixel-btn text-xl p-3">Add</button></form>
                        <div id="topics-container" class="mt-4 scroll-container"><ul id="topics-list" class="space-y-2"></ul></div>
                    </div>
                </div>
            </div>

            <!-- Games Container -->
            <div id="games-container" class="hidden">
                 <div class="text-center mb-6">
                    <h2 class="text-3xl mb-4 font-bold">W√§hle ein Spiel</h2>
                    <div class="flex justify-center gap-4">
                        <button id="select-hangman-btn" class="game-mode-btn active p-4 text-xl font-bold border-3">Galgenm√§nnchen</button>
                        <button id="select-article-btn" class="game-mode-btn p-4 text-xl font-bold border-3">Artikel-Raten</button>
                    </div>
                </div>
                <div id="hangman-wrapper">
                    <div class="inner-box p-6">
                        <div class="text-center mb-6 relative">
                            <h2 class="text-3xl font-bold">KI-Galgenm√§nnchen</h2>
                            <button id="rules-btn" class="absolute top-0 right-0 text-gray-400 hover:text-white transition">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                            </button>
                        </div>
                        <div id="hangman-controls" class="flex flex-col gap-4 mb-6 p-4 bg-black/20">
                            <h3 class="text-2xl font-bold text-center -mb-2">Spieleinstellungen</h3>
                            <div class="flex flex-col sm:flex-row gap-4 w-full">
                               <div class="flex-1">
                                    <label class="mb-2 block text-center font-semibold text-xl">1. Modus</label>
                                    <div class="grid grid-cols-2 gap-2">
                                        <button id="single-player-btn" class="game-mode-btn active p-2 font-bold border-3 text-lg">Einzel</button>
                                        <button id="team-mode-btn" class="game-mode-btn p-2 font-bold border-3 text-lg">Team</button>
                                    </div>
                                </div>
                                <div id="num-teams-container" class="flex-1 hidden">
                                    <label for="num-teams-input" class="mb-2 block text-center font-semibold text-xl">Teams</label>
                                    <input type="number" id="num-teams-input" value="2" min="2" class="pixel-input w-full p-2 text-center text-xl">
                                </div>
                            </div>
                             <div class="flex flex-col sm:flex-row gap-4 w-full">
                                <div class="flex-1">
                                    <label class="mb-2 block text-center font-semibold text-xl">2. Thema & Niveau</label>
                                    <input type="text" id="hangman-topic-input" placeholder="Thema (z.B. Tiere)" class="pixel-input text-xl w-full p-2">
                                </div>
                                <div class="flex-1">
                                    <label class="mb-2 block text-center text-black/0 font-semibold text-xl">.</label>
                                    <select id="hangman-level-select" class="pixel-input text-xl w-full p-2">
                                        <option value="A1">Anf√§nger (A1)</option><option value="A2">Grundlagen (A2)</option><option value="B1">Mittelstufe (B1)</option><option value="B2">Gute Mittelstufe (B2)</option>
                                    </select>
                                </div>
                            </div>
                            <button id="hangman-generate-btn" class="pixel-btn text-2xl py-3 px-6 mt-2 self-center">
                                <span id="generate-btn-text">Spiel starten</span>
                            </button>
                        </div>
                        <div id="scoreboard" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-6"></div>
                        <div id="hangman-game" class="flex flex-col items-center gap-4 opacity-25 pointer-events-none">
                            <div class="relative w-48 h-56 mb-4">
                                <svg id="hangman-drawing" viewBox="0 0 100 120" class="w-full h-full">
                                    <line x1="20" y1="110" x2="80" y2="110" stroke="#9ca3af" stroke-width="4" /> <line x1="30" y1="110" x2="30" y2="10" stroke="#9ca3af" stroke-width="4"/> <line x1="30" y1="10" x2="70" y2="10" stroke="#9ca3af" stroke-width="4"/> <line x1="70" y1="10" x2="70" y2="25" stroke="#9ca3af" stroke-width="3"/>
                                    <g id="hangman-figure">
                                        <circle class="hangman-part" cx="70" cy="35" r="10" stroke="white" stroke-width="3" fill="none" /> <line class="hangman-part" x1="70" y1="45" x2="70" y2="75" stroke="white" stroke-width="3"/> <line class="hangman-part" x1="70" y1="55" x2="55" y2="70" stroke="white" stroke-width="3"/> <line class="hangman-part" x1="70" y1="55" x2="85" y2="70" stroke="white" stroke-width="3"/> <line class="hangman-part" x1="70" y1="75" x2="55" y2="90" stroke="white" stroke-width="3"/> <line class="hangman-part" x1="70" y1="75" x2="85" y2="90" stroke="white" stroke-width="3"/>
                                    </g>
                                </svg>
                            </div>
                            <p id="hangman-word" class="text-5xl font-bold tracking-widest"></p>
                            <div class="text-center">
                                 <p class="text-gray-400 text-xl">Falsche Buchstaben:</p>
                                 <p id="hangman-wrong-letters" class="text-2xl text-red-400 font-bold min-h-[36px]"></p>
                            </div>
                            <div id="hangman-keyboard" class="flex flex-wrap justify-center gap-2 max-w-lg"></div>
                            <div id="hangman-message" class="text-3xl font-bold text-center min-h-[40px]"></div>
                            <div class="flex items-center gap-4 mt-4">
                                <button id="guess-word-btn" class="pixel-btn text-xl py-2 px-6">Wort raten</button>
                                <button id="next-round-btn" class="pixel-btn pixel-btn-green text-xl py-2 px-6 hidden">N√§chste Runde</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="article-guesser-wrapper" class="hidden">
                     <div class="inner-box p-6">
                        <div class="text-center mb-6">
                            <h2 class="text-3xl font-bold">Artikel-Raten</h2>
                        </div>
                        <div id="article-controls" class="flex flex-col gap-4 mb-6 p-4 bg-black/20">
                            <h3 class="text-2xl font-bold text-center -mb-2">Settings</h3>
                            <div class="flex flex-col sm:flex-row gap-4 w-full">
                                <div class="flex-1"><label class="mb-2 block text-center font-semibold text-xl">Thema</label><input type="text" id="article-topic-input" placeholder="Thema (z.B. K√ºche)" class="pixel-input text-xl w-full p-2"></div>
                                <div class="flex-1"><label class="mb-2 block text-center font-semibold text-xl">Niveau</label><select id="article-level-select" class="pixel-input text-xl w-full p-2"><option value="A1">Anf√§nger (A1)</option><option value="A2">Grundlagen (A2)</option><option value="B1">Mittelstufe (B1)</option></select></div>
                            </div>
                            <button id="article-generate-btn" class="pixel-btn text-2xl py-3 px-6 self-center mt-2">
                                <span id="article-generate-btn-text">START</span>
                            </button>
                        </div>
                        <div id="article-game" class="flex flex-col items-center gap-6 opacity-25 pointer-events-none">
                            <div class="text-center">
                                <p id="article-game-message" class="text-2xl text-center min-h-[32px]"></p>
                                <p id="article-word-display" class="text-6xl font-bold my-4 min-h-[72px]"></p>
                            </div>
                            <div id="article-choices" class="flex gap-4">
                                <button data-article="DER" class="article-btn pixel-btn p-6 text-3xl">DER</button>
                                <button data-article="DIE" class="article-btn pixel-btn pixel-btn-red p-6 text-3xl">DIE</button>
                                <button data-article="DAS" class="article-btn pixel-btn pixel-btn-green p-6 text-3xl">DAS</button>
                            </div>
                            <div id="article-scoreboard" class="flex gap-6 mt-4 text-2xl">
                                <div>Richtig: <span id="article-score-correct" class="font-bold text-green-400">0</span></div>
                                <div>Falsch: <span id="article-score-wrong" class="font-bold text-red-400">0</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <div id="guess-word-modal" class="modal fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 opacity-0 pointer-events-none -translate-y-10">
        <div class="main-container p-6 w-full max-w-md text-center">
            <h3 id="guess-modal-title" class="text-3xl font-bold mb-4 text-white"></h3>
            <p class="mb-4 text-xl text-gray-300">Gib das ganze Wort ein.</p>
            <input type="text" id="guess-word-input" class="pixel-input w-full p-2 text-center text-2xl uppercase tracking-widest">
            <div class="flex gap-4 mt-6">
                <button id="submit-guess-btn" class="pixel-btn text-xl w-full p-2">OK</button>
                <button id="cancel-guess-btn" class="pixel-btn pixel-btn-red text-xl w-full p-2">Abbrechen</button>
            </div>
        </div>
    </div>
    
    <div id="rules-modal" class="modal fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center p-4 opacity-0 pointer-events-none -translate-y-10">
        <div class="main-container p-6 w-full max-w-lg text-left">
            <div class="flex justify-between items-center mb-4">
                 <h3 class="text-3xl font-bold text-white">Spielregeln</h3>
                 <button id="close-rules-btn" class="text-gray-400 hover:text-white text-5xl leading-none">&times;</button>
            </div>
             <!-- ... (rules content unchanged) ... -->
        </div>
    </div>

    <script>
        // --- LOADING SCREEN ---
        const loadingScreen = document.getElementById('loading-screen');
        const startAppBtn = document.getElementById('start-app-btn');
        const mainContent = document.querySelector('main');

        startAppBtn.addEventListener('click', () => {
            playSound('click');
            initAudio(); // Ensure audio is ready
            loadingScreen.classList.add('opacity-0', 'pointer-events-none');
            mainContent.classList.remove('opacity-0', 'pointer-events-none');
        });


        // --- SOUND ENGINE ---
        let audioCtx;
        let isSoundOn = true;
        const soundToggleBtn = document.getElementById('sound-toggle-btn');
        
        function initAudio() { if (!audioCtx) { audioCtx = new (window.AudioContext || window.webkitAudioContext)(); } }

        function playSound(type) {
            if (!isSoundOn || !audioCtx) return;
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            switch(type) {
                case 'click':
                    oscillator.type = 'square';
                    oscillator.frequency.setValueAtTime(440, audioCtx.currentTime);
                    gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.1);
                    oscillator.stop(audioCtx.currentTime + 0.1);
                    break;
                case 'correct':
                    oscillator.type = 'sine';
                    oscillator.frequency.setValueAtTime(523.25, audioCtx.currentTime);
                    gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.2);
                    oscillator.stop(audioCtx.currentTime + 0.2);
                    break;
                case 'wrong':
                    oscillator.type = 'sawtooth';
                    oscillator.frequency.setValueAtTime(220, audioCtx.currentTime);
                    gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.2);
                    oscillator.stop(audioCtx.currentTime + 0.2);
                    break;
                case 'win':
                     oscillator.type = 'triangle';
                    oscillator.frequency.setValueAtTime(523.25, audioCtx.currentTime);
                    oscillator.frequency.linearRampToValueAtTime(1046.50, audioCtx.currentTime + 0.2);
                    gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.2);
                    oscillator.stop(audioCtx.currentTime + 0.2);
                    break;
                case 'defeat':
                    const now = audioCtx.currentTime;
                    gainNode.gain.setValueAtTime(0.2, now);
                    oscillator.type = 'triangle';
                    oscillator.frequency.setValueAtTime(220, now); // A3
                    gainNode.gain.exponentialRampToValueAtTime(0.0001, now + 0.5);
                    oscillator.frequency.exponentialRampToValueAtTime(110, now + 0.5); // A2
                    oscillator.stop(now + 0.5);
                    break;
            }
            oscillator.start();
        }
        
        soundToggleBtn.addEventListener('click', () => { isSoundOn = !isSoundOn; soundToggleBtn.textContent = isSoundOn ? 'Sound: ON' : 'Sound: OFF'; playSound('click'); });
       
        // --- STARFIELD BACKGROUND ---
        // ... (starfield JS is unchanged) ...
        const starfieldCanvas = document.getElementById('starfield');
        const starfieldCtx = starfieldCanvas.getContext('2d');
        let stars = [];
        function resizeStarfield() { starfieldCanvas.width = window.innerWidth; starfieldCanvas.height = window.innerHeight; }
        function createStars() { stars = []; for(let i = 0; i < 200; i++) { stars.push({ x: Math.random() * starfieldCanvas.width, y: Math.random() * starfieldCanvas.height, size: Math.random() * 2 + 1, speed: Math.random() * 0.5 + 0.1 }); } }
        function drawStars() { starfieldCtx.clearRect(0, 0, starfieldCanvas.width, starfieldCanvas.height); starfieldCtx.fillStyle = '#f0f0f0'; stars.forEach(star => { star.y += star.speed; if(star.y > starfieldCanvas.height) { star.y = 0; star.x = Math.random() * starfieldCanvas.width; } starfieldCtx.fillRect(star.x, star.y, star.size, star.size); }); requestAnimationFrame(drawStars); }
        window.addEventListener('resize', () => { resizeStarfield(); createStars(); });
        resizeStarfield();
        createStars();
        drawStars();
        
        // --- CORE & GAME LOGIC ---
        // Most of the logic is unchanged, only the `endRound` function for hangman is modified for the new animation.
        // Full JS code is included for completeness.
        const studentForm = document.getElementById('student-form');
        const studentInput = document.getElementById('student-name-input');
        const studentsList = document.getElementById('students-list');
        const studentCountDisplay = document.getElementById('student-count');
        const topicForm = document.getElementById('topic-form');
        const topicInput = document.getElementById('topic-name-input');
        const topicsList = document.getElementById('topics-list');
        const splitGroupsBtn = document.getElementById('split-groups-btn');
        const randomPersonBtn = document.getElementById('random-person-btn');
        const numGroupsInput = document.getElementById('num-groups');
        const groupsContainer = document.getElementById('groups-container');
        const randomPersonDisplay = document.getElementById('random-person-animation-container');
        const messageBox = document.getElementById('message-box');
        const toolsTabBtn = document.getElementById('tools-tab-btn');
        const gamesTabBtn = document.getElementById('games-tab-btn');
        const toolsContainer = document.getElementById('tools-container');
        const gamesContainer = document.getElementById('games-container');
        let students = [];
        let topics = [];
        let createdGroups = [];
        function saveData() { localStorage.setItem('students_data', JSON.stringify(students)); localStorage.setItem('topics_data', JSON.stringify(topics)); renderStudents(); renderTopics(); }
        function loadData() { const storedStudents = localStorage.getItem('students_data'); const storedTopics = localStorage.getItem('topics_data'); if (storedStudents) students = JSON.parse(storedStudents); if (storedTopics) topics = JSON.parse(storedTopics); renderStudents(); renderTopics(); }
        function renderStudents() { studentsList.innerHTML = ''; const presentStudents = students.filter(s => !s.absent).length; studentCountDisplay.textContent = `(${presentStudents} / ${students.length} anwesend)`; students.forEach((student, index) => { const li = document.createElement('li'); li.classList.add('flex', 'items-center', 'justify-between', 'p-2', 'pr-3', 'bg-gray-800/50', 'rounded-lg'); const nameClasses = student.absent ? 'text-gray-500 line-through' : ''; li.innerHTML = `<span class="text-xl flex-grow ${nameClasses}">${student.name}</span><div class="flex items-center gap-4"><label class="flex items-center cursor-pointer"><span class="mr-2 text-lg">Abwesend</span><input type="checkbox" data-index="${index}" class="form-checkbox h-6 w-6 text-purple-600 bg-gray-700 border-gray-600 rounded focus:ring-purple-500"></label><button data-index="${index}" class="remove-student-btn text-red-500 hover:text-red-400"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg></button></div>`; studentsList.appendChild(li); }); }
        function renderTopics() { topicsList.innerHTML = ''; topics.forEach((topic, index) => { const li = document.createElement('li'); li.classList.add('flex', 'items-center', 'justify-between', 'p-2', 'bg-gray-800/50', 'rounded-lg'); li.innerHTML = `<span class="text-xl">${topic}</span><button data-index="${index}" class="remove-topic-btn text-red-500 hover:text-red-400"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg></button>`; topicsList.appendChild(li); }); }
        studentForm.addEventListener('submit', (e) => { e.preventDefault(); const studentName = studentInput.value.trim(); if (studentName) { playSound('click'); students.push({ name: studentName, absent: false }); studentInput.value = ''; saveData(); } });
        topicForm.addEventListener('submit', (e) => { e.preventDefault(); const topicName = topicInput.value.trim(); if (topicName) { playSound('click'); topics.push(topicName); topicInput.value = ''; saveData(); } });
        studentsList.addEventListener('click', (e) => { const removeBtn = e.target.closest('.remove-student-btn'); if (removeBtn) { playSound('click'); students.splice(removeBtn.dataset.index, 1); saveData(); } });
        studentsList.addEventListener('change', (e) => { if (e.target.matches('.form-checkbox')) { playSound('click'); students[e.target.dataset.index].absent = e.target.checked; saveData(); } });
        topicsList.addEventListener('click', (e) => { const removeBtn = e.target.closest('.remove-topic-btn'); if (removeBtn) { playSound('click'); topics.splice(removeBtn.dataset.index, 1); saveData(); } });
        function shuffleArray(array) { for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1));[array[i], array[j]] = [array[j], array[i]]; } return array; }
        splitGroupsBtn.addEventListener('click', () => { playSound('click'); const presentStudents = students.filter(s => !s.absent).map(s => s.name); const numGroups = parseInt(numGroupsInput.value, 10); if (numGroups < 1 || numGroups > presentStudents.length) { messageBox.textContent = `Bitte geben Sie eine Zahl zwischen 1 und ${presentStudents.length} ein.`; messageBox.classList.remove('hidden'); return; } messageBox.classList.add('hidden'); const shuffledStudents = shuffleArray([...presentStudents]); const shuffledTopics = shuffleArray([...topics]); groupsContainer.innerHTML = ''; randomPersonDisplay.classList.remove('active'); createdGroups = Array.from({ length: numGroups }, () => ({ students: [], topic: null })); let studentIndex = 0; while (studentIndex < shuffledStudents.length) { for (let i = 0; i < numGroups; i++) { if (studentIndex < shuffledStudents.length) { createdGroups[i].students.push(shuffledStudents[studentIndex]); studentIndex++; } } } if (topics.length > 0) { for (let i = 0; i < numGroups; i++) { createdGroups[i].topic = shuffledTopics[i % shuffledTopics.length]; } } displayGroups(createdGroups); });
        function displayGroups(groups) { groupsContainer.innerHTML = ''; const groupElements = []; groups.forEach((group, index) => { const groupDiv = document.createElement('div'); groupDiv.classList.add('bg-gray-800/50', 'p-6', 'rounded-lg', 'flex', 'flex-col', 'gap-4'); let topicHtml = group.topic ? `<p class="text-center text-lg">Thema: <span class="font-bold text-purple-300">${group.topic}</span></p>` : ''; groupDiv.innerHTML = `<h3 class="text-xl font-bold text-center">Gruppe ${index + 1}</h3>${topicHtml}<ul class="space-y-2">${group.students.map(student => `<li class="p-2 bg-gray-900/50 rounded-md text-lg">${student}</li>`).join('')}</ul>`; groupsContainer.appendChild(groupDiv); groupElements.push(groupDiv); }); }
        randomPersonBtn.addEventListener('click', () => { playSound('click'); const presentStudents = students.filter(s => !s.absent).map(s => s.name); groupsContainer.innerHTML = ''; messageBox.classList.add('hidden'); randomPersonDisplay.classList.add('active'); if (presentStudents.length === 0) { randomPersonDisplay.innerHTML = `<p class="p-4 bg-red-900/50 rounded-lg">Keine anwesenden Sch√ºler zum Ausw√§hlen vorhanden.</p>`; return; } randomPersonBtn.disabled = true; const selectedStudent = presentStudents[Math.floor(Math.random() * presentStudents.length)]; randomPersonDisplay.innerHTML = `<div id="scrolling-names-list-wrapper" class="overflow-hidden w-full h-full"><div id="scrolling-names-list" class="flex flex-row items-center h-full"></div></div>`; const namesList = document.getElementById('scrolling-names-list'); const duplicatedNames = []; const namesPerGroup = presentStudents.length; const groupsToDisplay = 20; const randomIndexInFinalGroup = Math.floor(Math.random() * namesPerGroup); const finalStudentAbsoluteIndex = (groupsToDisplay - 1) * namesPerGroup + randomIndexInFinalGroup; for (let i = 0; i < groupsToDisplay - 1; i++) { duplicatedNames.push(...shuffleArray([...presentStudents])); } const finalGroup = shuffleArray([...presentStudents]); finalGroup.splice(randomIndexInFinalGroup, 0, selectedStudent); duplicatedNames.push(...finalGroup); duplicatedNames.forEach(name => { const p = document.createElement('p'); p.classList.add('p-2', 'text-3xl', 'mx-4', 'inline-block', 'whitespace-nowrap'); p.textContent = name; namesList.appendChild(p); }); const finalElement = namesList.children[finalStudentAbsoluteIndex]; setTimeout(() => { const containerWidth = randomPersonDisplay.offsetWidth; const finalPosition = finalElement.offsetLeft - (containerWidth / 2) + (finalElement.offsetWidth / 2); namesList.style.transition = 'transform 2.5s cubic-bezier(0.25, 0.1, 0.25, 1)'; namesList.style.transform = `translateX(-${finalPosition}px)`; }, 100); namesList.addEventListener('transitionend', () => { playSound('win'); randomPersonBtn.disabled = false; finalElement.classList.add('bg-green-500/50', 'p-2', 'rounded-lg'); }, { once: true }); });
        toolsTabBtn.addEventListener('click', () => { playSound('click'); toolsContainer.classList.remove('hidden'); gamesContainer.classList.add('hidden'); toolsTabBtn.classList.add('active'); gamesTabBtn.classList.remove('active'); });
        gamesTabBtn.addEventListener('click', () => { playSound('click'); toolsContainer.classList.add('hidden'); gamesContainer.classList.remove('hidden'); toolsTabBtn.classList.remove('active'); gamesTabBtn.classList.add('active'); });
        const hangmanWrapper = document.getElementById('hangman-wrapper');
        const articleGuesserWrapper = document.getElementById('article-guesser-wrapper');
        const selectHangmanBtn = document.getElementById('select-hangman-btn');
        const selectArticleBtn = document.getElementById('select-article-btn');
        selectHangmanBtn.addEventListener('click', () => { playSound('click'); hangmanWrapper.classList.remove('hidden'); articleGuesserWrapper.classList.add('hidden'); selectHangmanBtn.classList.add('active'); selectArticleBtn.classList.remove('active'); });
        selectArticleBtn.addEventListener('click', () => { playSound('click'); hangmanWrapper.classList.add('hidden'); articleGuesserWrapper.classList.remove('hidden'); selectHangmanBtn.classList.remove('active'); selectArticleBtn.classList.add('active'); });
        const hangmanGameEl = document.getElementById('hangman-game');
        const hangmanTopicInput = document.getElementById('hangman-topic-input');
        const hangmanLevelSelect = document.getElementById('hangman-level-select');
        const hangmanGenerateBtn = document.getElementById('hangman-generate-btn');
        const generateBtnText = document.getElementById('generate-btn-text');
        const hangmanWordEl = document.getElementById('hangman-word');
        const hangmanDrawing = document.getElementById('hangman-drawing');
        const hangmanFigure = document.getElementById('hangman-figure');
        const hangmanParts = hangmanDrawing.querySelectorAll('.hangman-part');
        const hangmanWrongLettersEl = document.getElementById('hangman-wrong-letters');
        const hangmanKeyboardEl = document.getElementById('hangman-keyboard');
        const hangmanMessageEl = document.getElementById('hangman-message');
        const scoreboardEl = document.getElementById('scoreboard');
        const guessWordBtn = document.getElementById('guess-word-btn');
        const nextRoundBtn = document.getElementById('next-round-btn');
        const singlePlayerBtn = document.getElementById('single-player-btn');
        const teamModeBtn = document.getElementById('team-mode-btn');
        const numTeamsContainer = document.getElementById('num-teams-container');
        const numTeamsInput = document.getElementById('num-teams-input');
        const guessWordModal = document.getElementById('guess-word-modal');
        const guessModalTitle = document.getElementById('guess-modal-title');
        const guessWordInput = document.getElementById('guess-word-input');
        const submitGuessBtn = document.getElementById('submit-guess-btn');
        const cancelGuessBtn = document.getElementById('cancel-guess-btn');
        const rulesBtn = document.getElementById('rules-btn');
        const rulesModal = document.getElementById('rules-modal');
        const closeRulesBtn = document.getElementById('close-rules-btn');
        const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ√Ñ√ñ√ú'.split('');
        const maxWrongGuesses = 6;
        let gameMode = 'single';
        let gameState = {};
        singlePlayerBtn.addEventListener('click', () => { playSound('click'); gameMode = 'single'; singlePlayerBtn.classList.add('active'); teamModeBtn.classList.remove('active'); numTeamsContainer.classList.add('hidden'); });
        teamModeBtn.addEventListener('click', () => { playSound('click'); gameMode = 'team'; teamModeBtn.classList.add('active'); singlePlayerBtn.classList.remove('active'); numTeamsContainer.classList.remove('hidden'); });
        function resetGameState() { gameState = { teams: [], currentTeamIndex: 0, selectedWord: '', correctLetters: [], wrongLetters: [], isRoundOver: true, wordList: [], currentWordIndex: 0, }; }
        async function startGame() { playSound('click'); const topic = hangmanTopicInput.value.trim(); const level = hangmanLevelSelect.value; if (!topic) { alert("Bitte geben Sie ein Thema ein."); return; }
            hangmanGenerateBtn.disabled = true; generateBtnText.textContent = 'Generiere...'; hangmanGameEl.classList.add('opacity-25', 'pointer-events-none'); hangmanMessageEl.textContent = 'KI generiert W√∂rter...'; scoreboardEl.innerHTML = '';
            const apiKey = ""; const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`; const prompt = `Generate a list of 10 single German nouns (without articles) related to the topic '${topic}'. The words should be suitable for a German language learner at the ${level} level. The words should not contain spaces or special characters other than √Ñ, √ñ, √ú. Return ONLY a comma-separated list of the words in uppercase. For example: HUND,KATZE,HAUS`;
            try { const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] }) }); if (!response.ok) throw new Error(`API error! status: ${response.status}`);
                const result = await response.json(); const text = result.candidates?.[0]?.content?.parts?.[0]?.text; if (!text) throw new Error('Keine W√∂rter von der KI erhalten.');
                const words = text.split(',').map(word => word.trim().toUpperCase()).filter(word => word.length > 0); if(words.length === 0) throw new Error('KI konnte keine W√∂rter generieren.');
                resetGameState();
                if (gameMode === 'single') { gameState.teams = [{ id: 0, name: 'Spieler 1', score: 0 }]; } else { const numTeams = parseInt(numTeamsInput.value, 10); if (isNaN(numTeams) || numTeams < 2) { alert("Bitte geben Sie eine g√ºltige Team-Anzahl ein."); throw new Error("Invalid team number"); } gameState.teams = Array.from({ length: numTeams }, (_, i) => ({ id: i, name: `Team ${i + 1}`, score: 0 })); }
                gameState.wordList = shuffleArray(words); startNewRound();
            } catch (error) { console.error('Error in startGame:', error); if (error.message !== "Invalid team number") { hangmanMessageEl.textContent = `Fehler: ${error.message}`; }
            } finally { hangmanGenerateBtn.disabled = false; generateBtnText.textContent = 'Spiel starten'; } }
        function startNewRound() { if (gameState.currentWordIndex >= gameState.wordList.length) { endGame(); return; }
            gameState.selectedWord = gameState.wordList[gameState.currentWordIndex]; gameState.currentWordIndex++; gameState.correctLetters = []; gameState.wrongLetters = []; gameState.isRoundOver = false;
            hangmanGameEl.classList.remove('opacity-25', 'pointer-events-none'); hangmanFigure.classList.remove('is-defeated'); hangmanParts.forEach(part => part.style.visibility = 'hidden'); hangmanMessageEl.textContent = ''; nextRoundBtn.classList.add('hidden'); guessWordBtn.classList.remove('hidden');
            displayHangmanWord(); updateWrongLetters(); createKeyboard(); renderScoreboard(); }
        function renderScoreboard() { scoreboardEl.innerHTML = ''; if (gameState.teams.length <= 1) return;
            gameState.teams.forEach((team, index) => { const card = document.createElement('div'); card.classList.add('bg-gray-800/50', 'p-3', 'rounded-lg', 'text-center', 'transition-all', 'border-2', 'border-transparent'); if (index === gameState.currentTeamIndex) { card.classList.add('border-purple-500', 'scale-105'); }
                card.innerHTML = `<p class="font-bold text-lg">${team.name}</p><p id="score-${team.id}" class="text-2xl font-bold text-purple-300">${team.score}</p>`; scoreboardEl.appendChild(card); }); }
        function displayHangmanWord() { if (!gameState.selectedWord) return;
            hangmanWordEl.innerHTML = gameState.selectedWord.split('').map(letter => `<span>${gameState.correctLetters.includes(letter) ? letter : '_'}</span>`).join('');
            const innerWord = hangmanWordEl.innerText.replace(/\s/g, ''); if (!gameState.isRoundOver && innerWord === gameState.selectedWord) { awardPoints(10); endRound(true); } }
        function updateWrongLetters() { hangmanWrongLettersEl.textContent = `${gameState.wrongLetters.join(', ')}`; hangmanParts.forEach((part, index) => { if (index < gameState.wrongLetters.length) part.style.visibility = 'visible'; });
            if (!gameState.isRoundOver && gameState.wrongLetters.length >= maxWrongGuesses) { endRound(false); } }
        function createKeyboard() { hangmanKeyboardEl.innerHTML = ''; alphabet.forEach(letter => { const btn = document.createElement('button'); btn.textContent = letter; btn.classList.add('bg-purple-800', 'text-white', 'font-bold', 'py-2', 'px-4', 'rounded-lg', 'hover:bg-purple-700', 'transition', 'disabled:opacity-50', 'disabled:cursor-not-allowed'); btn.addEventListener('click', () => handleGuess(letter, btn)); hangmanKeyboardEl.appendChild(btn); }); }
        function handleGuess(letter, btn) { if (gameState.isRoundOver) return; btn.disabled = true; const upperCaseLetter = letter.toUpperCase();
            if (gameState.selectedWord.includes(upperCaseLetter)) { playSound('correct'); if (!gameState.correctLetters.includes(upperCaseLetter)) { gameState.correctLetters.push(upperCaseLetter); awardPoints(5); displayHangmanWord(); }
            } else { playSound('wrong'); if (!gameState.wrongLetters.includes(upperCaseLetter)) { gameState.wrongLetters.push(upperCaseLetter); updateWrongLetters(); changeTurn(); } } }
        function changeTurn() { if (gameState.teams.length <= 1) return; gameState.currentTeamIndex = (gameState.currentTeamIndex + 1) % gameState.teams.length; renderScoreboard(); }
        function awardPoints(points) { if (gameState.teams.length === 0) return; const currentTeam = gameState.teams[gameState.currentTeamIndex]; currentTeam.score += points; const scoreEl = document.getElementById(`score-${currentTeam.id}`); if (scoreEl) { scoreEl.textContent = currentTeam.score; } }
        function endRound(isWin) { gameState.isRoundOver = true; hangmanKeyboardEl.querySelectorAll('button').forEach(btn => btn.disabled = true); guessWordBtn.classList.add('hidden');
            if (isWin) { playSound('win'); const winnerName = gameState.teams.length > 1 ? gameState.teams[gameState.currentTeamIndex].name : 'Du hast'; hangmanMessageEl.textContent = `${winnerName} GEWONNEN!`; nextRoundBtn.classList.remove('hidden');
            } else { playSound('defeat'); hangmanFigure.classList.add('is-defeated'); hangmanMessageEl.textContent = `VERLOREN! Wort: ${gameState.selectedWord}`; setTimeout(() => { nextRoundBtn.classList.remove('hidden'); }, 1500); } }
        function endGame() { let winnerMessage = ''; if (gameState.teams.length > 1) { const winner = gameState.teams.reduce((prev, current) => (prev.score > current.score) ? prev : current); winnerMessage = `GAME OVER! ${winner.name} gewinnt! üéâ`;
            } else { winnerMessage = 'Alle W√∂rter gespielt!'; }
            hangmanMessageEl.textContent = winnerMessage; nextRoundBtn.classList.add('hidden'); guessWordBtn.classList.add('hidden'); }
        function openModal(modal) { playSound('click'); modal.classList.remove('opacity-0', 'pointer-events-none', '-translate-y-10'); }
        function closeModal(modal) { playSound('click'); modal.classList.add('opacity-0', 'pointer-events-none', '-translate-y-10'); }
        function handleWordGuess() { const guess = guessWordInput.value.trim().toUpperCase(); if (!guess) return;
            if (guess === gameState.selectedWord) { awardPoints(25); gameState.correctLetters = gameState.selectedWord.split(''); displayHangmanWord(); endRound(true);
            } else { playSound('wrong'); const guesserName = gameState.teams.length > 1 ? gameState.teams[gameState.currentTeamIndex].name : 'Du hast'; hangmanMessageEl.textContent = `${guesserName} falsch geraten!`; changeTurn(); }
            closeModal(guessWordModal); }
        guessWordBtn.addEventListener('click', () => openModal(guessWordModal));
        cancelGuessBtn.addEventListener('click', () => closeModal(guessWordModal));
        rulesBtn.addEventListener('click', () => openModal(rulesModal));
        closeRulesBtn.addEventListener('click', () => closeModal(rulesModal));
        submitGuessBtn.addEventListener('click', handleWordGuess);
        guessWordInput.addEventListener('keyup', (e) => { if(e.key === 'Enter') handleWordGuess(); });
        nextRoundBtn.addEventListener('click', ()=>{playSound('click'); startNewRound()});
        hangmanGenerateBtn.addEventListener('click', startGame);
        const articleControls = document.getElementById('article-controls');
        const articleGame = document.getElementById('article-game');
        const articleTopicInput = document.getElementById('article-topic-input');
        const articleLevelSelect = document.getElementById('article-level-select');
        const articleGenerateBtn = document.getElementById('article-generate-btn');
        const articleGenerateBtnText = document.getElementById('article-generate-btn-text');
        const articleWordDisplay = document.getElementById('article-word-display');
        const articleChoices = document.getElementById('article-choices');
        const articleScoreCorrect = document.getElementById('article-score-correct');
        const articleScoreWrong = document.getElementById('article-score-wrong');
        const articleGameMessage = document.getElementById('article-game-message');
        let articleGameState = {};
        function resetArticleGameState() { articleGameState = { wordList: [], currentWordIndex: 0, correct: 0, wrong: 0, }; }
        async function startArticleGame() { playSound('click'); const topic = articleTopicInput.value.trim(); const level = articleLevelSelect.value; if (!topic) { alert("Bitte geben Sie ein Thema ein."); return; }
            articleGenerateBtn.disabled = true; articleGenerateBtnText.textContent = 'Generiere...'; articleGame.classList.add('opacity-25', 'pointer-events-none');
            const apiKey = ""; const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const prompt = `Generate a list of 10 German nouns with their definite article (DER, DIE, or DAS) related to the topic '${topic}', suitable for a ${level} learner. Return ONLY a comma-separated list. Example: DER HUND,DIE KATZE,DAS HAUS`;
            try {
                const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ contents: [{ parts: [{ text: prompt }] }] }) });
                if (!response.ok) throw new Error(`API error! status: ${response.status}`);
                const result = await response.json(); const text = result.candidates?.[0]?.content?.parts?.[0]?.text; if (!text) throw new Error('Keine W√∂rter von der KI erhalten.');
                const words = text.split(',').map(pair => { const parts = pair.trim().split(' '); return { article: parts[0], noun: parts[1] }; }).filter(w => w.article && w.noun);
                 if(words.length === 0) throw new Error('KI konnte keine W√∂rter generieren.');
                resetArticleGameState();
                articleGameState.wordList = shuffleArray(words);
                articleGame.classList.remove('opacity-25', 'pointer-events-none');
                nextArticleWord();
            } catch (error) { console.error(error); articleGameMessage.textContent = `Fehler: ${error.message}`;
            } finally { articleGenerateBtn.disabled = false; articleGenerateBtnText.textContent = 'START'; } }
        function nextArticleWord() { if (articleGameState.currentWordIndex >= articleGameState.wordList.length) { articleWordDisplay.textContent = "Fertig!"; articleGameMessage.textContent = `Endstand: ${articleGameState.correct} Richtig, ${articleGameState.wrong} Falsch.`; articleChoices.classList.add('hidden'); return; }
            articleGameMessage.textContent = `Wort ${articleGameState.currentWordIndex + 1} / ${articleGameState.wordList.length}`;
            const currentWord = articleGameState.wordList[articleGameState.currentWordIndex];
            articleWordDisplay.textContent = currentWord.noun;
            articleScoreCorrect.textContent = articleGameState.correct;
            articleScoreWrong.textContent = articleGameState.wrong;
            articleChoices.classList.remove('hidden'); }
        articleChoices.addEventListener('click', (e) => { if (!e.target.matches('.article-btn')) return;
            const chosenArticle = e.target.dataset.article;
            const correctArticle = articleGameState.wordList[articleGameState.currentWordIndex].article;
            if (chosenArticle === correctArticle) { playSound('correct'); articleGameState.correct++; articleGameMessage.textContent = "Richtig!";
            } else { playSound('wrong'); articleGameState.wrong++; articleGameMessage.textContent = `Falsch! Richtig ist: ${correctArticle} ${articleGameState.wordList[articleGameState.currentWordIndex].noun}`; }
            articleGameState.currentWordIndex++; setTimeout(nextArticleWord, 1500); });
        articleGenerateBtn.addEventListener('click', startArticleGame);
        document.addEventListener('DOMContentLoaded', () => { resetGameState(); loadData(); });
    </script>
</body>
</html>

